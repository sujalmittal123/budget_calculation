import { betterAuth } from 'better-auth';
import { mongodbAdapter } from 'better-auth/adapters/mongodb';
import mongoose from 'mongoose';

/**
 * Better-Auth Configuration
 * 
 * Secure session-based authentication with Google OAuth
 */

export const auth = betterAuth({
  // Base URL and secret - REQUIRED
  baseURL: process.env.BETTER_AUTH_URL || 'http://localhost:5000',
  secret: process.env.BETTER_AUTH_SECRET,
  
  // Database adapter - uses existing MongoDB connection
  database: mongodbAdapter(mongoose.connection),
  
  // Social providers configuration
  socialProviders: {
    google: {
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    },
  },

  // Session configuration
  session: {
    expiresIn: 60 * 60 * 24 * 30, // 30 days
    updateAge: 60 * 60 * 24, // Update every 24 hours
  },

  // Trust origins for CORS
  trustedOrigins: [
    'http://localhost:5173',
    'http://localhost:3000',
  ],
});
